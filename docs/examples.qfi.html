---

title: QFI


keywords: fastai
sidebar: home_sidebar

summary: "Implementation of the method introduced in <a href='https://arxiv.org/pdf/2104.00519.pdf'>this paper</a>."
description: "Implementation of the method introduced in <a href='https://arxiv.org/pdf/2104.00519.pdf'>this paper</a>."
nb_path: "nbs/01_examples.qfi.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_examples.qfi.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">qiskit.opflow</span> <span class="kn">import</span> <span class="n">CircuitStateFn</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">BasicAer</span>

<span class="kn">from</span> <span class="nn">fisherman.randomized</span> <span class="kn">import</span> <span class="n">randomized_measurement_overlap</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">BasicAer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;statevector_simulator&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;θ0&#39;</span><span class="p">),</span> <span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;θ1&#39;</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">theta0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitStateFn</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="n">param_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">theta0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">theta1</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
<span class="n">dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_params</span><span class="p">,</span> <span class="n">n_dth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtheta</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">parameters</span>
<span class="n">qfi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_params</span><span class="p">,</span> <span class="n">n_params</span><span class="p">))</span>
<span class="n">idx0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">dtheta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">sub_qfi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">qfi</span><span class="p">):</span> <span class="k">return</span> <span class="n">qfi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">*</span><span class="n">n_dth</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">param_values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">param_values</span><span class="p">[</span><span class="n">param_i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dth</span> <span class="k">for</span> <span class="n">dth</span> <span class="ow">in</span> <span class="n">dtheta</span><span class="p">]</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">randomized_measurement_overlap</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">n_rnd</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="n">overlap</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span>
        <span class="n">super_fidelity</span> <span class="o">=</span> <span class="n">overlap</span><span class="p">[</span><span class="n">idx0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">overlap</span><span class="p">[</span><span class="n">idx0</span><span class="p">,</span> <span class="n">idx0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">overlap</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()))</span>
        <span class="n">bures_distance</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">super_fidelity</span><span class="p">))</span>

        <span class="n">est_qfi</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">sub_qfi</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">bures_distance</span><span class="p">)</span>
        <span class="n">qfi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">est_qfi</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qfi</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[1.36533357, 0.        ],
       [0.        , 0.18256721]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

